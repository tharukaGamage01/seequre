!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((n="undefined"!=typeof globalThis?globalThis:n||self).jotaiVanilla={})}(this,(function(n){"use strict";var t=0;function r(n){return n(this)}function e(n,t,r){return t(this,"function"==typeof r?r(n(this)):r)}function o(n,t){(null==t||t>n.length)&&(t=n.length);for(var r=0,e=new Array(t);r<t;r++)e[r]=n[r];return e}function i(n,t){var r="undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(r)return(r=r.call(n)).next.bind(r);if(Array.isArray(n)||(r=function(n,t){if(n){if("string"==typeof n)return o(n,t);var r=Object.prototype.toString.call(n).slice(8,-1);return"Object"===r&&n.constructor&&(r=n.constructor.name),"Map"===r||"Set"===r?Array.from(n):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(n,t):void 0}}(n))||t&&n&&"number"==typeof n.length){r&&(n=r);var e=0;return function(){return e>=n.length?{done:!0}:{done:!1,value:n[e++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,u=function(n,t){return n.unstable_is?n.unstable_is(t):t===n},f=function(n){return"init"in n},c=function(n){return!!n.write},v=new WeakMap,l=function(n,t){var r=v.get(n);r&&(v.delete(n),r(t))},d=function(n,t){n.status="fulfilled",n.value=t},s=function(n,t){n.status="rejected",n.reason=t},h=function(n,t){return!!n&&"v"in n&&"v"in t&&Object.is(n.v,t.v)},p=function(n,t){return!!n&&"e"in n&&"e"in t&&Object.is(n.e,t.e)},g=function(n){return!!n&&"v"in n&&n.v instanceof Promise},w=function(n){if("e"in n)throw n.e;return n.v},y=function(){var n=new WeakMap,t=new WeakMap,r=[],e=new WeakMap,o=function(t){return n.get(t)},a=function n(t,i){i.d.forEach((function(i,a){if(!e.has(a)){var u,f=o(a);null==(u=r[r.length-1])||u.add(a),e.set(a,[f,new Set]),f&&n(a,f)}e.get(a)[1].add(t)}))},y=function(t,i){var u,f=o(t);(n.set(t,i),e.has(t))||(null==(u=r[r.length-1])||u.add(t),e.set(t,[f,new Set]),a(t,i));if(g(f)){var c="v"in i?i.v instanceof Promise?i.v:Promise.resolve(i.v):Promise.reject(i.e);f.v!==c&&l(f.v,c)}},b=function(n,t,r,e){var o=new Map(e?t.d:null),i=!1;r.forEach((function(r,e){!r&&u(n,e)&&(r=t),r&&(o.set(e,r),t.d.get(e)!==r&&(i=!0))})),(i||t.d.size!==o.size)&&(t.d=o)},m=function(n,t,r,e){var i,a,u=o(n),f={d:(null==u?void 0:u.d)||new Map,v:t};if(r&&b(n,f,r,e),h(u,f)&&u.d===f.d)return u;if(g(u)&&g(f)&&(a=f,"v"in(i=u)&&"v"in a&&i.v.orig&&i.v.orig===a.v.orig)){if(u.d===f.d)return u;f.v=u.v}return y(n,f),f},S=function(n,r,e,i){if("function"==typeof(null==(c=r)?void 0:c.then)){var a,u=function(){var r=o(n);if(g(r)&&r.v===f){var i=m(n,f,e);t.has(n)&&r.d!==i.d&&x(n,i,r.d)}},f=new Promise((function(n,t){var e=!1;r.then((function(t){e||(e=!0,d(f,t),n(t),u())}),(function(n){e||(e=!0,s(f,n),t(n),u())})),a=function(t){e||(e=!0,t.then((function(n){return d(f,n)}),(function(n){return s(f,n)})),n(t))}}));return f.orig=r,f.status="pending",function(n,t){v.set(n,t),n.catch((function(){})).finally((function(){return v.delete(n)}))}(f,(function(n){n&&a(n),null==i||i()})),m(n,f,e,!0)}var c;return m(n,r,e)},E=function n(r,e){var i=o(r);if(!e&&i){if(t.has(r))return i;if(Array.from(i.d).every((function(t){var e=t[0],o=t[1];if(e===r)return!0;var i=n(e);return i===o||h(i,o)})))return i}var a,v,l=new Map,d=!0,s={get signal(){return a||(a=new AbortController),a.signal},get setSelf(){return!v&&c(r)&&(v=function(){if(!d){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];return k.apply(void 0,[r].concat(t))}}),v}};try{var g=r.read((function(t){if(u(r,t)){var e=o(t);if(e)return l.set(t,e),w(e);if(f(t))return l.set(t,void 0),t.init;throw new Error("no atom init")}var i=n(t);return l.set(t,i),w(i)}),s);return S(r,g,l,(function(){var n;return null==(n=a)?void 0:n.abort()}))}catch(n){return function(n,t,r){var e=o(n),i={d:(null==e?void 0:e.d)||new Map,e:t};return r&&b(n,i,r),p(e,i)&&e.d===i.d?e:(y(n,i),i)}(r,n,l)}finally{d=!1}},A=function(n,t){return!t.l.size&&(!t.t.size||1===t.t.size&&t.t.has(n))},M=function(n){var r=new Array,a=new Set;!function n(o){if(!a.has(o)){a.add(o);for(var u,f=i(function(n){var r,o,i=new Set(null==(r=t.get(n))?void 0:r.t);return null==(o=e.get(n))||o[1].forEach((function(n){i.add(n)})),i}(o));!(u=f()).done;){var c=u.value;o!==c&&n(c)}r.push(o)}}(n);for(var u=new Set([n]),f=r.length-1;f>=0;--f){var c=r[f],v=o(c);if(v){for(var l,d=!1,s=i(v.d.keys());!(l=s()).done;){var p=l.value;if(p!==c&&u.has(p)){d=!0;break}}if(d){var g=E(c,!0);h(v,g)||u.add(c)}}}},j=function n(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),a=1;a<e;a++)i[a-1]=arguments[a];var c=t.write.apply(t,[function(n){return w(E(n))},function(e){var i,a=r.length>0;a||r.push(new Set([e]));for(var c=arguments.length,v=new Array(c>1?c-1:0),l=1;l<c;l++)v[l-1]=arguments[l];if(u(t,e)){if(!f(e))throw new Error("atom not writable");var d=o(e),s=S(e,v[0]);h(d,s)||M(e)}else i=n.apply(void 0,[e].concat(v));return a||O(r.pop()),i}].concat(i));return c},k=function(n){r.push(new Set([n]));for(var t=arguments.length,e=new Array(t>1?t-1:0),o=1;o<t;o++)e[o-1]=arguments[o];var i=j.apply(void 0,[n].concat(e));return O(r.pop()),i},z=function n(r,e,i){var a,u=i||[];null==(a=o(r))||a.d.forEach((function(e,o){var i=t.get(o);i?i.t.add(r):o!==r&&n(o,r,u)})),E(r);var f={t:new Set(e&&[e]),l:new Set};if(t.set(r,f),c(r)&&r.onMount){var v=r.onMount;u.push((function(){var n=v((function(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];return k.apply(void 0,[r].concat(t))}));n&&(f.u=n)}))}return i||u.forEach((function(n){return n()})),f},P=function n(r){var e,i=null==(e=t.get(r))?void 0:e.u;i&&i(),t.delete(r);var a=o(r);a&&(g(a)&&l(a.v),a.d.forEach((function(e,o){if(o!==r){var i=t.get(o);i&&(i.t.delete(r),A(o,i)&&n(o))}})))},x=function(n,r,e){var o=new Set(r.d.keys()),i=new Set;null==e||e.forEach((function(r,e){if(o.has(e))o.delete(e);else{i.add(e);var a=t.get(e);a&&a.t.delete(n)}})),o.forEach((function(r){var e=t.get(r);e?e.t.add(n):t.has(n)&&z(r,n)})),i.forEach((function(n){var r=t.get(n);r&&A(n,r)&&P(n)}))},O=function(n){var r=[];n.forEach((function n(t){var i;if(e.has(t)){var a=e.get(t),u=a[0],f=a[1];e.delete(t),r.push([t,u]),f.forEach(n),null==(i=o(t))||i.d.forEach((function(t,r){return n(r)}))}})),r.forEach((function(n){var r=n[0],e=n[1],i=o(r);if(i&&i!==e){var a=t.get(r);a&&i.d!==(null==e?void 0:e.d)&&x(r,i,null==e?void 0:e.d),a&&(g(e)||!h(e,i)&&!p(e,i))&&a.l.forEach((function(n){return n()}))}}))};return{get:function(n){return w(E(n))},set:k,sub:function(n,r){var e=function(n){var r=t.get(n);return r||(r=z(n)),r}(n);O([n]);var o=e.l;return o.add(r),function(){o.delete(r),function(n){var r=t.get(n);r&&A(n,r)&&P(n)}(n)}}}};n.atom=function(n,o){var i="atom"+ ++t,a={toString:function(){return i}};return"function"==typeof n?a.read=n:(a.init=n,a.read=r,a.write=e),o&&(a.write=o),a},n.createStore=y,n.getDefaultStore=function(){return a||(a=y()),a}}));
